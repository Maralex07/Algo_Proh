<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продвинутый тренажёр горячих клавиш</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #000;
            color: #fff;
        }
        
        h1 {
            text-align: center;
            color: #bb86fc;
            margin-bottom: 30px;
        }
        
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .shortcuts-list {
            flex: 1;
            min-width: 300px;
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(187, 134, 252, 0.2);
        }
        
        .training-area {
            flex: 2;
            min-width: 400px;
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(187, 134, 252, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        .shortcut-item {
            padding: 12px;
            margin: 8px 0;
            background-color: #2d2d2d;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            border-left: 3px solid #bb86fc;
        }
        
        .shortcut-item:hover {
            background-color: #383838;
        }
        
        .shortcut-key {
            background-color: #ffeb3b;
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            font-weight: bold;
        }
        
        .action-text {
            font-weight: 500;
            color: #fff;
        }
        
        .task-display {
            flex-grow: 1;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100px;
            border: 1px solid #bb86fc;
        }
        
        .current-task {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
            color: #ffeb3b;
        }
        
        .hint {
            font-size: 14px;
            color: #bb86fc;
            text-align: center;
            margin-top: 10px;
        }
        
        .key-press-display {
            margin-top: 20px;
            font-size: 24px;
            min-height: 40px;
            text-align: center;
            color: #fff;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background-color: #2d2d2d;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        .stat-label {
            font-size: 12px;
            color: #bb86fc;
            text-transform: uppercase;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: #383838;
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #bb86fc;
            width: 0%;
            transition: width 0.3s;
        }
        
        .keyboard-key {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            background-color: #2d2d2d;
            color: #fff;
            border-radius: 4px;
            border: 1px solid #bb86fc;
            font-family: monospace;
            font-size: 14px;
            box-shadow: 0 2px 0 #bb86fc;
        }
        
        .keyboard-key.active {
            background-color: #ffeb3b;
            color: #000;
            transform: translateY(2px);
            box-shadow: 0 0 0 #bb86fc;
        }
        
        .keyboard-visual {
            margin-top: 20px;
            text-align: center;
        }
        
        .keyboard-row {
            margin-bottom: 5px;
        }
        
        .success-message {
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            height: 20px;
        }
        
        .error-message {
            color: #f44336;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            height: 20px;
        }
        
        button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #bb86fc;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #ffeb3b;
        }
        
        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }
        
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
            background-color: #2d2d2d;
            padding: 8px 16px;
            border-radius: 4px;
            min-width: 100px;
            text-align: center;
        }
        
        .difficulty-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #2d2d2d;
            border-radius: 8px;
        }
        
        .difficulty-option {
            padding: 8px 15px;
            background-color: #383838;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .difficulty-option.active {
            background-color: #bb86fc;
            color: #000;
            font-weight: bold;
        }
        
        .combo-counter {
            font-size: 14px;
            color: #ffeb3b;
            text-align: center;
            margin-top: 10px;
        }
        
        .time-pressure {
            height: 5px;
            background-color: #f44336;
            width: 0%;
            margin-top: 5px;
            border-radius: 3px;
            transition: width 0.1s;
        }
        
        .layout-info {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #bb86fc;
        }
    </style>
</head>
<body>
    <h1>Продвинутый тренажёр горячих клавиш</h1>
    
    <div class="container">
        <div class="shortcuts-list">
            <h2 style="color: #ffeb3b;">Комбинации</h2>
            <div class="shortcut-item">
                <span class="action-text">Копировать</span>
                <span class="shortcut-key">Ctrl + C</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Вырезать</span>
                <span class="shortcut-key">Ctrl + X</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Вставить</span>
                <span class="shortcut-key">Ctrl + V</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Отменить</span>
                <span class="shortcut-key">Ctrl + Z</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Повторить</span>
                <span class="shortcut-key">Ctrl + Y</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Сохранить</span>
                <span class="shortcut-key">Ctrl + S</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Найти</span>
                <span class="shortcut-key">Ctrl + F</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Выделить всё</span>
                <span class="shortcut-key">Ctrl + A</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Открыть</span>
                <span class="shortcut-key">Ctrl + O</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Печать</span>
                <span class="shortcut-key">Ctrl + P</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Жирный текст</span>
                <span class="shortcut-key">Ctrl + B</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Курсив</span>
                <span class="shortcut-key">Ctrl + I</span>
            </div>
            <div class="shortcut-item">
                <span class="action-text">Подчёркивание</span>
                <span class="shortcut-key">Ctrl + U</span>
            </div>
        </div>
        
        <div class="training-area">
            <h2 style="color: #ffeb3b;">Тренировка</h2>
            
            <div class="difficulty-controls">
                <div class="difficulty-option active" data-level="easy">Новичок</div>
                <div class="difficulty-option" data-level="medium">Опытный</div>
                <div class="difficulty-option" data-level="hard">Эксперт</div>
                <div class="difficulty-option" data-level="extreme">Мастер</div>
            </div>
            
            <div class="task-display">
                <div class="current-task" id="current-task">Нажмите "Начать", чтобы начать тренировку</div>
                <div class="hint" id="hint">Используйте клавиатуру для ввода комбинаций</div>
                <div class="key-press-display" id="key-press-display"></div>
                <div class="time-pressure" id="time-pressure"></div>
            </div>
            
            <div class="timer-container">
                <div class="timer" id="timer">00:00</div>
            </div>
            
            <div class="combo-counter" id="combo-counter"></div>
            
            <div class="keyboard-visual">
                <div class="keyboard-row">
                    <span class="keyboard-key" id="key-ctrl">Ctrl</span>
                    <span class="keyboard-key" id="key-shift">Shift</span>
                    <span class="keyboard-key" id="key-alt">Alt</span>
                </div>
                <div class="keyboard-row">
                    <span class="keyboard-key" id="key-a">A</span>
                    <span class="keyboard-key" id="key-b">B</span>
                    <span class="keyboard-key" id="key-c">C</span>
                    <span class="keyboard-key" id="key-f">F</span>
                    <span class="keyboard-key" id="key-i">I</span>
                    <span class="keyboard-key" id="key-o">O</span>
                    <span class="keyboard-key" id="key-p">P</span>
                    <span class="keyboard-key" id="key-s">S</span>
                    <span class="keyboard-key" id="key-u">U</span>
                    <span class="keyboard-key" id="key-v">V</span>
                    <span class="keyboard-key" id="key-x">X</span>
                    <span class="keyboard-key" id="key-y">Y</span>
                    <span class="keyboard-key" id="key-z">Z</span>
                </div>
            </div>
            
            <div class="layout-info">
                Тренажёр работает с любой раскладкой клавиатуры
            </div>
            
            <div class="success-message" id="success-message"></div>
            <div class="error-message" id="error-message"></div>
            
            <button id="start-btn">Начать тренировку</button>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">Правильно</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wrong-count">0</div>
                    <div class="stat-label">Ошибки</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="score">0%</div>
                    <div class="stat-label">Точность</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="combo">0</div>
                    <div class="stat-label">Комбо</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы интерфейса
            const startBtn = document.getElementById('start-btn');
            const currentTask = document.getElementById('current-task');
            const hint = document.getElementById('hint');
            const keyPressDisplay = document.getElementById('key-press-display');
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');
            const progressBar = document.getElementById('progress-bar');
            const timer = document.getElementById('timer');
            const comboCounter = document.getElementById('combo-counter');
            const timePressure = document.getElementById('time-pressure');
            const difficultyOptions = document.querySelectorAll('.difficulty-option');
            
            // Статистика
            const correctCount = document.getElementById('correct-count');
            const wrongCount = document.getElementById('wrong-count');
            const score = document.getElementById('score');
            const comboStat = document.getElementById('combo');
            
            // Клавиши на виртуальной клавиатуре
            const keyboardKeys = {
                'ctrl': document.getElementById('key-ctrl'),
                'shift': document.getElementById('key-shift'),
                'alt': document.getElementById('key-alt'),
                'a': document.getElementById('key-a'),
                'b': document.getElementById('key-b'),
                'c': document.getElementById('key-c'),
                'f': document.getElementById('key-f'),
                'i': document.getElementById('key-i'),
                'o': document.getElementById('key-o'),
                'p': document.getElementById('key-p'),
                's': document.getElementById('key-s'),
                'u': document.getElementById('key-u'),
                'v': document.getElementById('key-v'),
                'x': document.getElementById('key-x'),
                'y': document.getElementById('key-y'),
                'z': document.getElementById('key-z')
            };
            
            // Список всех комбинаций для тренировки
            const allShortcuts = [
                { action: 'Копировать', keys: ['Control', 'c'], display: 'Ctrl + C' },
                { action: 'Вырезать', keys: ['Control', 'x'], display: 'Ctrl + X' },
                { action: 'Вставить', keys: ['Control', 'v'], display: 'Ctrl + V' },
                { action: 'Отменить', keys: ['Control', 'z'], display: 'Ctrl + Z' },
                { action: 'Повторить', keys: ['Control', 'y'], display: 'Ctrl + Y' },
                { action: 'Сохранить', keys: ['Control', 's'], display: 'Ctrl + S' },
                { action: 'Найти', keys: ['Control', 'f'], display: 'Ctrl + F' },
                { action: 'Выделить всё', keys: ['Control', 'a'], display: 'Ctrl + A' },
                { action: 'Открыть', keys: ['Control', 'o'], display: 'Ctrl + O' },
                { action: 'Печать', keys: ['Control', 'p'], display: 'Ctrl + P' },
                { action: 'Жирный текст', keys: ['Control', 'b'], display: 'Ctrl + B' },
                { action: 'Курсив', keys: ['Control', 'i'], display: 'Ctrl + I' },
                { action: 'Подчёркивание', keys: ['Control', 'u'], display: 'Ctrl + U' }
            ];
            
            // Состояние тренировки
            let isTraining = false;
            let currentShortcut = null;
            let pressedKeys = new Set();
            let correctAnswers = 0;
            let wrongAnswers = 0;
            let totalAttempts = 0;
            let timerInterval = null;
            let seconds = 0;
            let combo = 0;
            let maxCombo = 0;
            let difficulty = 'easy';
            let timeLimit = 0;
            let timeLeft = 0;
            let timePressureInterval = null;
            let usedShortcuts = [];
            
            // Начать тренировку
            startBtn.addEventListener('click', function() {
                isTraining = true;
                correctAnswers = 0;
                wrongAnswers = 0;
                totalAttempts = 0;
                combo = 0;
                maxCombo = 0;
                seconds = 0;
                usedShortcuts = [];
                updateStats();
                startBtn.textContent = 'Перезапустить';
                
                // Установка времени в зависимости от сложности
                setTimeLimit();
                
                // Запуск таймера
                if (timerInterval) clearInterval(timerInterval);
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
                
                nextTask();
            });
            
            // Установка уровня сложности
            difficultyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    difficultyOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    difficulty = this.dataset.level;
                    setTimeLimit();
                });
            });
            
            // Установка лимита времени в зависимости от сложности
            function setTimeLimit() {
                switch(difficulty) {
                    case 'easy':
                        timeLimit = 0; // Без ограничения времени
                        break;
                    case 'medium':
                        timeLimit = 10; // 10 секунд
                        break;
                    case 'hard':
                        timeLimit = 7; // 7 секунд
                        break;
                    case 'extreme':
                        timeLimit = 5; // 5 секунд
                        break;
                }
                timeLeft = timeLimit;
                updateTimePressure();
            }
            
            // Обновление таймера
            function updateTimer() {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                
                // Обновление счетчика времени для сложных режимов
                if (timeLimit > 0 && currentShortcut) {
                    timeLeft--;
                    updateTimePressure();
                    
                    if (timeLeft <= 0) {
                        // Время вышло
                        errorMessage.textContent = 'Время вышло!';
                        wrongAnswers++;
                        totalAttempts++;
                        combo = 0;
                        updateStats();
                        
                        setTimeout(() => {
                            if (isTraining) nextTask();
                        }, 1000);
                    }
                }
            }
            
            // Обновление индикатора времени
            function updateTimePressure() {
                if (timeLimit > 0) {
                    const percent = (timeLeft / timeLimit) * 100;
                    timePressure.style.width = `${percent}%`;
                    
                    // Изменение цвета в зависимости от оставшегося времени
                    if (percent < 30) {
                        timePressure.style.backgroundColor = '#f44336'; // Красный
                    } else if (percent < 60) {
                        timePressure.style.backgroundColor = '#ff9800'; // Оранжевый
                    } else {
                        timePressure.style.backgroundColor = '#4CAF50'; // Зеленый
                    }
                } else {
                    timePressure.style.width = '0%';
                }
            }
            
            // Генерация нового задания с учетом сложности
            function nextTask() {
                // Выбираем случайную комбинацию с учетом сложности
                let availableShortcuts = [...allShortcuts];
                
                // На сложных уровнях не повторяем последние 3 комбинации
                if (difficulty === 'hard' || difficulty === 'extreme') {
                    availableShortcuts = availableShortcuts.filter(sc => 
                        !usedShortcuts.slice(-3).includes(sc.action)
                    );
                }
                
                currentShortcut = availableShortcuts[Math.floor(Math.random() * availableShortcuts.length)];
                usedShortcuts.push(currentShortcut.action);
                
                currentTask.textContent = `Выполните: ${currentShortcut.action}`;
                
                // На сложных уровнях скрываем подсказку
                if (difficulty === 'extreme') {
                    hint.textContent = 'Подсказка скрыта';
                } else {
                    hint.textContent = `Комбинация: ${currentShortcut.display}`;
                }
                
                keyPressDisplay.textContent = '';
                successMessage.textContent = '';
                errorMessage.textContent = '';
                pressedKeys.clear();
                
                // Сброс таймера для режимов с ограничением времени
                if (timeLimit > 0) {
                    timeLeft = timeLimit;
                    updateTimePressure();
                }
                
                // Сбрасываем подсветку клавиш
                Object.values(keyboardKeys).forEach(key => key.classList.remove('active'));
            }
            
            // Обработка нажатий клавиш
            document.addEventListener('keydown', function(e) {
                if (!isTraining) return;
                
                // Игнорируем повторные нажатия
                if (e.repeat) return;
                
                // Получаем физическую клавишу, а не символ
                const key = getPhysicalKey(e);
                
                // Блокируем стандартные действия браузера для тренируемых комбинаций
                if (e.ctrlKey && ['a', 'b', 'c', 'f', 'i', 'o', 'p', 's', 'u', 'v', 'x', 'y', 'z'].includes(key.toLowerCase())) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                pressedKeys.add(key);
                
                // Подсвечиваем клавишу на виртуальной клавиатуре
                if (keyboardKeys[key.toLowerCase()]) {
                    keyboardKeys[key.toLowerCase()].classList.add('active');
                } else if (key === 'Control' && keyboardKeys['ctrl']) {
                    keyboardKeys['ctrl'].classList.add('active');
                } else if (key === 'Alt' && keyboardKeys['alt']) {
                    keyboardKeys['alt'].classList.add('active');
                } else if (key === 'Shift' && keyboardKeys['shift']) {
                    keyboardKeys['shift'].classList.add('active');
                }
                
                updateKeyPressDisplay();
                
                // Проверяем комбинацию
                checkShortcut();
            }, true); // Используем capture phase для перехвата событий
            
            document.addEventListener('keyup', function(e) {
                if (!isTraining) return;
                
                const key = getPhysicalKey(e);
                pressedKeys.delete(key);
                
                // Снимаем подсветку с клавиши
                if (keyboardKeys[key.toLowerCase()]) {
                    keyboardKeys[key.toLowerCase()].classList.remove('active');
                } else if (key === 'Control' && keyboardKeys['ctrl']) {
                    keyboardKeys['ctrl'].classList.remove('active');
                } else if (key === 'Alt' && keyboardKeys['alt']) {
                    keyboardKeys['alt'].classList.remove('active');
                } else if (key === 'Shift' && keyboardKeys['shift']) {
                    keyboardKeys['shift'].classList.remove('active');
                }
            }, true);
            
            // Получение физической клавиши (не зависящей от раскладки)
            function getPhysicalKey(e) {
                // Для специальных клавиш используем key
                if (['Control', 'Shift', 'Alt', 'Meta'].includes(e.key)) {
                    return e.key;
                }
                
                // Для букв используем code, чтобы не зависеть от раскладки
                if (e.code && e.code.startsWith('Key')) {
                    return e.code.replace('Key', '');
                }
                
                // Для остальных случаев используем key
                return e.key;
            }
            
            // Обновление отображения нажатых клавиш
            function updateKeyPressDisplay() {
                const keysArray = Array.from(pressedKeys);
                const displayKeys = keysArray.map(k => {
                    if (k === 'Control') return 'Ctrl';
                    if (k === ' ') return 'Space';
                    return k.length === 1 ? k.toUpperCase() : k;
                });
                
                keyPressDisplay.textContent = displayKeys.join(' + ');
            }
            
            // Проверка правильности комбинации
            function checkShortcut() {
                if (!currentShortcut) return;
                
                const pressedArray = Array.from(pressedKeys);
                const expectedKeys = currentShortcut.keys.map(k => k.toLowerCase());
                const pressedNormalized = pressedArray.map(k => k.toLowerCase());
                
                // Проверяем, что все нужные клавиши нажаты
                const allExpectedPressed = expectedKeys.every(k => 
                    pressedNormalized.includes(k.toLowerCase())
                );
                
                // Проверяем, что не нажато лишних клавиш
                const noExtraKeys = pressedNormalized.every(k => 
                    expectedKeys.includes(k.toLowerCase())
                );
                
                if (allExpectedPressed && noExtraKeys) {
                    // Правильная комбинация
                    successMessage.textContent = '✓ Верно!';
                    errorMessage.textContent = '';
                    correctAnswers++;
                    totalAttempts++;
                    combo++;
                    if (combo > maxCombo) maxCombo = combo;
                    updateStats();
                    
                    // Обновляем счетчик комбо
                    updateComboCounter();
                    
                    // Задержка перед следующим заданием
                    setTimeout(() => {
                        if (isTraining) nextTask();
                    }, difficulty === 'extreme' ? 500 : 1000);
                } else if (pressedArray.length >= expectedKeys.length) {
                    // Неправильная комбинация
                    errorMessage.textContent = '✗ Неверно, попробуйте ещё';
                    wrongAnswers++;
                    totalAttempts++;
                    combo = 0;
                    updateStats();
                    updateComboCounter();
                }
            }
            
            // Обновление счетчика комбо
            function updateComboCounter() {
                if (combo > 3) {
                    comboCounter.textContent = `Комбо x${combo}!`;
                    comboCounter.style.color = getComboColor(combo);
                } else {
                    comboCounter.textContent = '';
                }
            }
            
            // Получение цвета для комбо в зависимости от его длины
            function getComboColor(combo) {
                if (combo > 15) return '#ff00ff'; // Фиолетовый
                if (combo > 10) return '#00ffff'; // Голубой
                if (combo > 7) return '#ffff00'; // Желтый
                if (combo > 5) return '#00ff00'; // Зеленый
                return '#ffeb3b'; // Желтый (по умолчанию)
            }
            
            // Обновление статистики
            function updateStats() {
                correctCount.textContent = correctAnswers;
                wrongCount.textContent = wrongAnswers;
                comboStat.textContent = maxCombo;
                
                const accuracy = totalAttempts > 0 ? 
                    Math.round((correctAnswers / totalAttempts) * 100) : 0;
                score.textContent = `${accuracy}%`;
                
                // Обновление прогресс-бара
                const totalTasks = correctAnswers + wrongAnswers;
                const progress = totalTasks > 0 ? (correctAnswers / (allShortcuts.length * 2)) * 100 : 0;
                progressBar.style.width = `${Math.min(progress, 100)}%`;
            }
        });
    </script>
</body>
</html>
